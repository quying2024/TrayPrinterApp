# 打印店自动打印系统 - 部署与配置指南

## 目录
1. [环境要求](#1-环境要求)
2. [安装步骤](#2-安装步骤)
3. [配置文件详解](#3-配置文件详解)
4. [日常操作指南](#4-日常操作指南)
5. [系统维护](#5-系统维护)

## 1. 环境要求

### 硬件要求
- 处理器：Intel Core i3 或同等性能处理器
- 内存：4GB RAM
- 硬盘空间：至少100MB可用空间（不含日志和归档文件）
- 网络：无特殊要求（本地打印机需正确连接）

### 软件要求
- 操作系统：Windows 7/8/10/11（32位或64位）
- .NET Framework：4.8 或更高版本
- 打印程序：根据文件类型安装对应程序：
  - PDF文件：Adobe Acrobat Reader DC 或 Adobe Acrobat Pro DC
  - Word文件：Microsoft Office Word 2013+
  - 图片文件：系统自带画图程序（通常已预装）

## 2. 安装步骤

### 2.1 基础安装
1. 下载系统压缩包 `PrintShopSystem_v1.0.zip`
2. 解压到目标目录（建议路径：`C:\Program Files\PrintShopSystem`）
3. 确认解压后文件夹结构：
   ```
   PrintShopSystem/
   ├── TrayApp.exe           # 主程序
   ├── config/
   │   └── appsettings.json  # 配置文件
   ├── logs/                 # 日志文件夹（自动创建）
   └── task_history.json     # 任务历史记录（自动创建）
   ```

### 2.2 配置微信文件接收路径
1. 打开微信，进入「设置」→「文件管理」
2. 记录「文件保存路径」（如 `C:\Users\用户名\Documents\WeChat Files\wxid_xxxx\FileStorage\File\2023-10`）
3. 创建监控子目录（如 `C:\WeChatPrintFiles`）
4. 在微信文件管理中设置「自动保存接收到的文件」到监控子目录

### 2.3 设置开机启动（可选）
1. 按下 `Win + R`，输入 `shell:startup` 打开启动文件夹
2. 创建 `TrayApp.exe` 的快捷方式（右键→发送到→桌面快捷方式，再复制到启动文件夹）
3. 确认快捷方式目标路径正确（如 `"C:\Program Files\PrintShopSystem\TrayApp.exe"`）

## 3. 配置文件详解

配置文件路径：`config/appsettings.json`，使用文本编辑器（如记事本）打开修改。

### 3.1 监控设置（Monitoring）
```json
"Monitoring": {
  "WatchPath": "C:\\WeChatPrintFiles",  // 监控目录路径（微信文件接收目录）
  "BatchTimeoutSeconds": 3,             // 批量收集超时时间（秒）
  "FileTypes": [".pdf", ".docx", ".jpg", ".png", ".doc"]  // 监控文件类型
}
```
- **WatchPath**：必须与微信文件接收目录一致
- **BatchTimeoutSeconds**：建议保持默认3秒，连续发送文件会自动合并
- **FileTypes**：根据实际需求增删文件类型，格式为".扩展名"

### 3.2 打印机管理（PrinterManagement）
```json
"PrinterManagement": {
  "HiddenPrinters": ["Microsoft Print to PDF", "Fax", "OneNote"],  // 隐藏的打印机
  "DisplayOrder": "UsageFrequency"  // 排序方式：UsageFrequency（使用频率）/ Name（名称）
}
```
- **HiddenPrinters**：列出不需要显示的打印机名称（区分大小写）
- **DisplayOrder**：推荐使用"UsageFrequency"（常用打印机优先显示）

### 3.3 文件类型映射（FileTypeAssociations）
```json
"FileTypeAssociations": {
  ".pdf": {
    "ExecutorPath": "C:\\Program Files\\Adobe\\Acrobat DC\\Acrobat\\Acrobat.exe",
    "Arguments": "/t \"{FilePath}\" \"{PrinterName}\"",
    "PageCounterType": "PdfPageCounter"
  },
  ".docx": {
    "ExecutorPath": "C:\\Program Files\\Microsoft Office\\root\\Office16\\WINWORD.EXE",
    "Arguments": "/q /n \"{FilePath}\" /mFilePrintDefault /mFileExit",
    "PageCounterType": "WordPageCounter"
  }
}
```
- **ExecutorPath**：打印程序的完整路径，需根据实际安装位置调整
- **Arguments**：打印参数，`{FilePath}`和`{PrinterName}`为系统占位符，不可修改
- **PageCounterType**：页码计数器类型（无需修改）

> **注意**：如修改程序路径后无法打印，请检查路径中是否包含空格，如有需用双引号包裹（如`"C:\Program Files\Adobe\..."`）

### 3.4 任务历史（TaskHistory）
```json
"TaskHistory": {
  "MaxRecords": 5,           // 最大记录数量
  "StoragePath": "task_history.json"  // 历史记录保存路径
}
```

## 4. 日常操作指南

### 4.1 启动与退出
- **启动**：双击 `TrayApp.exe`，系统托盘会显示打印机图标
- **退出**：右键点击托盘图标→选择「退出」

### 4.2 打印流程
1. 顾客通过微信发送文件到指定账号
2. 文件自动保存到监控目录（如`C:\WeChatPrintFiles`）
3. 系统等待3秒无新增文件后，弹出打印机选择对话框
4. 选择目标打印机并点击「确定」
5. 文件自动打印，完成后归档到时间戳目录（如`C:\WeChatPrintFiles\20231020153022`）

### 4.3 查看历史记录
- **快速查看**：鼠标悬停在托盘图标上，显示最近5次打印的总页码
- **详细记录**：左键点击托盘图标，查看包含时间、文件数、页码、打印机的详细记录

### 4.4 紧急文件处理
1. 将紧急文件复制到监控目录
2. 在打印机选择对话框中选择目标打印机
3. 点击「确定」立即打印（无需等待常规批量队列）

## 5. 系统维护

### 5.1 日志管理
- 日志文件路径：`app.log`
- 日志内容：包含所有操作记录、错误信息和打印详情
- 清理策略：建议每周手动清理一次（保留最近7天日志）

### 5.2 归档文件管理
- 归档目录：监控目录下的时间戳文件夹（如`20231020153022`）
- 清理策略：建议每月清理一次过期归档（保留最近30天文件）

### 5.3 配置文件备份
- 修改配置前建议备份 `appsettings.json`（如重命名为`appsettings_backup.json`）
- 恢复配置时直接替换文件并重启程序

### 5.4 程序更新
1. 关闭当前运行的程序
2. 下载最新版本压缩包
3. 解压并覆盖原有文件（保留`config`目录和`task_history.json`）
4. 重新启动程序