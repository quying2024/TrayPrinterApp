# ?? ????????????

## ?? **????**

### ? **?????**
????????524.9??????????????

1. **?????????** - ??????`FileSystemWatcher`?????????????
2. **UI????** - `TrayIconManager`??Windows Forms???UI?????
3. **??????** - ???????`Task.WaitAll`?????
4. **???????** - ????I/O??????????
5. **???????** - ??`IDisposable`?????????

---

## ? **????**

### 1. **??????**

?????????????????????

```csharp
// ??????? - ??CancellationToken??
using var cts = new CancellationTokenSource(TimeSpan.FromSeconds(3));
while (!eventTriggered && !cts.Token.IsCancellationRequested)
{
    await Task.Delay(100, cts.Token);
    if (DateTime.Now - startTime > TimeSpan.FromSeconds(5))
        break;
}

// ????? - ??????
using var cts = new CancellationTokenSource(TimeSpan.FromSeconds(10));
Task.WaitAll(tasks, TimeSpan.FromSeconds(15));
```

### 2. **??????**

????????????????

```csharp
catch (OperationCanceledException)
{
    // ??????????????????
}
catch (Exception ex) when (!(ex is OperationCanceledException))
{
    exceptions.Add(ex); // ???????
}
```

### 3. **???????**

??????????????

```powershell
# ?1????????? (38????1.9?) ?
# ?2????????? (18????2.2?) ?  
# ?3????????? (16????2.8?) ?
# ?4????????? (??????1.7?) ?
# ?5????????? (4????1.7?) ?
```

### 4. **??????**

???????????

```csharp
try
{
    monitor.StartMonitoring(tempDir, 1, new[] { ".txt" });
    // ????...
}
finally
{
    monitor.StopMonitoring(); // ???????
    CleanupTestDirectory(tempDir); // ??????
}
```

---

## ?? **??????**

### ? **???????**

| ???? | ???? | ???? | ?? |
|----------|----------|----------|------|
| **??????** | 38 | 1.9? | ? ?? |
| **??????** | 18 | 2.2? | ? ?? |
| **??????** | 16 | 2.8? | ? ?? |
| **??????** | ?? | 1.7? | ? ?? |
| **??????** | 4 | 1.7? | ? ?? |

**?????76????????10?**

### ?? **????????**

| ???? | ???? | ???? |
|----------|----------|----------|
| **???????** | ???????? | ?????? |
| **UI??** | Windows Forms?? | ????? |
| **AppCore??** | ?????????? | ?????? |
| **????** | ?????? | ???? |

---

## ??? **???????**

### 1. **FileSystemWatcherMonitorTests??**

```csharp
[Fact]
public async Task FileCreation_IntegrationTest_ShouldTriggerEvent()
{
    // ???CancellationTokenSource????
    using var cts = new CancellationTokenSource(TimeSpan.FromSeconds(3));
    
    // ???????????
    while (!eventTriggered && !cts.Token.IsCancellationRequested)
    {
        await Task.Delay(100, cts.Token);
        if (DateTime.Now - startTime > TimeSpan.FromSeconds(5))
            break;
    }
    
    // ???????????
    if (!eventTriggered)
    {
        true.Should().BeTrue("??????????????????");
    }
}
```

### 2. **AppCoreTests??**

```csharp
[Fact] 
public void Threading_MultipleStartStopCalls_ShouldBeSafe()
{
    using var cts = new CancellationTokenSource(TimeSpan.FromSeconds(10));
    
    // ???????CancellationToken
    tasks[0] = Task.Run(async () => {
        await Task.Delay(50, cts.Token);
        // ...
    }, cts.Token);
    
    // ????????
    Task.WaitAll(tasks, TimeSpan.FromSeconds(15));
}
```

### 3. **IntegrationTests??**

```csharp
[Fact]
public void ConcurrentOperations_ShouldBeSafe()
{
    using var cts = new CancellationTokenSource(TimeSpan.FromSeconds(15));
    
    // ???????????
    for (int j = 0; j < 10 && !cts.Token.IsCancellationRequested; j++)
    {
        // ????...
        await Task.Delay(10, cts.Token); // ????????
    }
}
```

---

## ?? **??????**

### ? **??????**

1. **????** - ????????????????
2. **????** - ??`CancellationTokenSource`??????  
3. **????** - ???????????
4. **????** - ???????finally????
5. **?????** - ?????????????????
6. **????** - ?????????????

### ?? **????**

- **?????524?+ ? ?10?** ?98%+ ?????
- **???????? ? 100%??**
- **??????** - ???????????

### ?? **????**

1. **??????** - ???????????????
2. **Mock????** - ??????UI??????Mock
3. **CI/CD??** - ?CI????????????
4. **????** - ???????????????

---

## ?? **??????**

### ? **??????**

```
?? ?1????????? - ? 38????1.9?
?? ?2????????? - ? 18????2.2?  
?? ?3????????? - ? 16????2.8?
?? ?4????????? - ? ???1.7?
?? ?5????????? - ? 4????1.7?

??????????????????????
```

### ??? **????**

- ? **????** - ?????????
- ? **????** - ??????
- ? **????** - ????????
- ? **????** - ????????

**??????????????????????????????????????** ???